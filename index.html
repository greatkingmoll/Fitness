<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>4-Week Training Calendar</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:800px; margin:auto; padding:20px; background:#f5f5f5; }
    h1,h2,h3 { color:#2c3e50; }
    .section, .controls { background:#fff; margin-bottom:20px; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .controls { position:sticky; top:20px; }
    button { margin:5px; padding:8px 16px; border:none; background:#27ae60; color:#fff; border-radius:4px; cursor:pointer; }
    button:hover { background:#219651; }
    .progress-bar { background:#ecf0f1; border-radius:10px; overflow:hidden; height:20px; margin:10px 0; }
    .progress-fill { background:#27ae60; height:100%; width:0; transition:width .3s; }
    .collapsible { cursor:pointer; padding:10px; background:#2c3e50; color:#fff; border:none; width:100%; text-align:left; border-radius:4px; margin-bottom:10px; }
    .content { display:none; overflow:hidden; }
    .week { margin-bottom:10px; }
    .day { background:#fafafa; margin:8px 0; padding:10px; border-radius:4px; }
    .day-header { font-weight:bold; margin-bottom:6px; }
    .tracking { margin-bottom:10px; }
    .tracking-row { display:flex; align-items:center; margin-bottom:6px; }
    .tracking-row input[type="checkbox"] { transform:scale(1.2); margin-right:8px; }
    .tracking-row label { width:120px; }
    .tracking-row input[type="number"] { width:50px; margin-left:8px; padding:4px; }
  </style>
</head>
<body>
  <h1>4-Week Training Calendar</h1>

  <button class="collapsible">Exercise Reference & Form Cues</button>
  <div class="content section">
     <h2>Office Micro-Workouts</h2>
    <div class="exercise-item"><b>Wall Sit</b> Back flat, knees at 90°, brace core.</div>
    <div class="exercise-item"><b>Push-ups</b> Hands under shoulders, full range, core tight.</div>
    <div class="exercise-item"><b>Seated Band Row</b> Anchor band, hinge hips, retract scapula.</div>
    <div class="exercise-item"><b>Hip Hinge Drill</b> Hinge at hips, neutral spine.</div>
    <div class="exercise-item"><b>Plank w/ Shoulder Taps</b> Hips stable, tap opposite shoulder.</div>
    <div class="exercise-item"><b>Standing Calf Raises</b> Pause at top, control down.</div>
    <div class="exercise-item"><b>Split Squat</b> Rear foot elevated, front thigh parallel.</div>
    <div class="exercise-item"><b>Chair Dips</b> Elbows back, lean forward.</div>
    <div class="exercise-item"><b>Pallof Press</b> Press away, resist rotation.</div>
    <div class="exercise-item"><b>Glute Bridge March</b> Hips high, alternate knee drive.</div>
    <div class="exercise-item"><b>Incline Push-ups</b> Hands on desk, core braced.</div>
    <div class="exercise-item"><b>Lateral Band Walk</b> Band above knees, small steps.</div>
    <div class="exercise-item"><b>Single-Leg RDL</b> Hinge on one leg, spine neutral.</div>
    <div class="exercise-item"><b>Hollow-Body Hold</b> Lower back pressed, legs & arms off floor.</div>
    <div class="exercise-item"><b>Banded Overhead Press</b> Stand on band, press overhead.</div>

    <h2>Skill Practice</h2>
    <div class="exercise-item"><b>DNS Breathing</b> 5×30s diaphragmatic with brace.</div>
    <div class="exercise-item"><b>Bear Crawl Hold</b> Hips off floor, back flat.</div>
    <div class="exercise-item"><b>Bird Dog</b> Extend opposite arm/leg, hold 2-3s.</div>
    <div class="exercise-item"><b>Bodyweight Squat Practice</b> Slow 3s down, full depth.</div>
    <div class="exercise-item"><b>Wall Slides</b> Back & arms on wall, slide overhead.</div>
    <div class="exercise-item"><b>Hip 90/90 Stretch</b> Rotate knees, pause each side.</div>
    <div class="exercise-item"><b>Band Pull-aparts</b> Squeeze scapula, slow return.</div>
    <div class="exercise-item"><b>Cat-Cow</b> Alternate arch & sag, mobilize spine.</div>
    <div class="exercise-item"><b>Ankle Mobilization</b> Knee to wall, heel down.</div>

    <h2>Eccentric Program</h2>
    <div class="exercise-item"><b>Negative Pull-ups</b> 5s descent, control lowering.</div>
    <div class="exercise-item"><b>Nordic Hamstring Curls</b> 4-5s negative.</div>
    <div class="exercise-item"><b>Step-Down Negatives</b> 3s descent from 18" box.</div>
    <div class="exercise-item"><b>Eccentric Push-ups</b> 4s lower, feet elevated.</div>
    <div class="exercise-item"><b>Single-Leg RDL Negative</b> 3s hinge descent.</div>

    <h2>Heavy Lifting</h2>
    <div class="exercise-item"><b>Deadlift</b> Neutral spine, bar close, drive hips.</div>
    <div class="exercise-item"><b>Goblet Squat</b> Chest up, depth to parallel.</div>
    <div class="exercise-item"><b>Farmer's Carry</b> Brace core, steady pace.</div>
    <div class="exercise-item"><b>Assisted Pull-ups</b> Full range, scapula retracted.</div>
    <div class="exercise-item"><b>Push-up Variant</b> Full depth, core tight.</div>
  </div>

  <div class="controls">
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    <div>Progress: <span id="progress-text">0%</span> <span id="sync-status">⏳ Loading...</span></div>
    <button onclick="exportLog()">Export Log</button>
  </div>

  <div id="calendar-container"></div>

  <script>
    const BIN='68b792b243b1c97be934fbf5', KEY='$2a$10$xw2r19X4duqK08padyE3rOwnbACLQJTQhuk2rLK1ooSWJ1N8xJ.MW', API='https://api.jsonbin.io/v3/b/';
    const start=new Date("2025-09-08");
    const micro=["Wall Sit","Push-ups","Seated Band Row","Hip Hinge Drill","Plank w/ Shoulder Taps","Standing Calf Raises","Split Squat","Chair Dips","Pallof Press","Glute Bridge March","Incline Push-ups","Lateral Band Walk","Single-Leg RDL","Hollow-Body Hold","Banded Overhead Press"];
    const skills=["DNS Breathing","Bear Crawl Hold","Bird Dog","Hip 90/90 Stretch","Bodyweight Squat Practice","Wall Slides","Band Pull-aparts","Cat-Cow","Ankle Mobilization"];
    const eccA=["Negative Pull-ups","Nordic Hamstring Curls","Eccentric Push-ups"], eccB=["Step-Down Negatives","Single-Leg RDL Negative","Negative Pull-ups"];
    const heavyLower=["Deadlift","Goblet Squat","Farmer's Carry"], heavyUpper=["Assisted Pull-ups","Push-up Variant"];
    const calendar=[];
    for(let w=0;w<4;w++){
      const days=[];
      for(let d=0;d<7;d++){
        const dt=new Date(start); dt.setDate(start.getDate()+w*7+d);
        const dd=String(dt.getDate()).padStart(2,"0"), mon=dt.toLocaleDateString("en-GB",{month:"short",year:"2-digit"});
        const date=`${dd}-${mon}`, idx=dt.getDay(), names=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
        let ex=[];
        if(idx===1){ ex=[...heavyLower]; for(let i=0;i<3;i++) ex.push(micro[(w*3+i)%15]); }
        else if(idx===2){ for(let i=3;i<6;i++) ex.push(micro[(w*3+i)%15]); ex.push(...skills.slice(w%skills.length, w%skills.length+2)); }
        else if(idx===3){ for(let i=6;i<9;i++) ex.push(micro[(w*3+i)%15]); ex.push(...(w%2?eccB:eccA)); }
        else if(idx===4){ for(let i=9;i<12;i++) ex.push(micro[(w*3+i)%15]); ex.push(...skills.slice((w+1)%skills.length, (w+1)%skills.length+2)); }
        else if(idx===5){ ex=[...heavyUpper]; for(let i=12;i<15;i++) ex.push(micro[(w*3+i)%15]); }
        else if(idx===6){ ex.push(...skills.slice((w+2)%skills.length, (w+2)%skills.length+2)); }
        days.push({day:names[idx],date,ex});
      }
      calendar.push({week:w+1,range:`${days[1].date} - ${days[5].date}`,days});
    }

    let prog={}, openSections=[], online=navigator.onLine;
    function upd(s){ const e=document.getElementById('sync-status'); e.textContent={synced:'☁️ Synced',pending:'⏳ Syncing...',error:'❌ Offline'}[s]; e.style.color={synced:'#27ae60',pending:'#f39c12',error:'#e74c3c'}[s]; }
    async function load(){ upd('pending'); if(!online){ prog=JSON.parse(localStorage.getItem("prog")||"{}"); return;} try{ const r=await fetch(`${API}${BIN}/latest`,{headers:{'X-Master-Key':KEY}}); if(!r.ok) throw r; prog=(await r.json()).record||{}; localStorage.setItem("prog",JSON.stringify(prog)); upd('synced'); } catch{ prog=JSON.parse(localStorage.getItem("prog")||"{}"); upd('error'); } }
    async function save(){ if(!online){ localStorage.setItem("prog",JSON.stringify(prog)); return;} try{ const r=await fetch(API+BIN,{method:'PUT',headers:{'Content-Type':'application/json','X-Master-Key':KEY,'X-Bin-Versioning':false},body:JSON.stringify(prog)}); if(!r.ok) throw r; localStorage.setItem("prog",JSON.stringify(prog)); upd('synced'); } catch{ localStorage.setItem("prog",JSON.stringify(prog)); upd('error'); } }

    function render(){
      openSections=[]; document.querySelectorAll('.collapsible').forEach((b,i)=>{ if(b.nextElementSibling.style.display==='block') openSections.push(i); });
      const c=document.getElementById('calendar-container'); c.innerHTML=''; let total=0, done=0;
      calendar.forEach(wk=>{
        const btn=document.createElement('button'); btn.className='collapsible'; btn.textContent=`Week ${wk.week} - ${wk.range}`;
        const sec=document.createElement('div'); sec.className='content week';
        wk.days.forEach(d=>{
          let html=`<div class="day"><div class="day-header">${d.day} (${d.date})</div>`;
          const groups={
            "Heavy Lifting":d.ex.filter(e=>heavyLower.concat(heavyUpper).includes(e)),
            "Micro-Workout":d.ex.filter(e=>micro.includes(e)),
            "Skill Practice":d.ex.filter(e=>skills.includes(e)),
            "Eccentric Program":d.ex.filter(e=>eccA.concat(eccB).includes(e))
          };
          for(const [title, exs] of Object.entries(groups)){
            if(exs.length){
              html+=`<h3>${title}</h3><div class="tracking">`;
              exs.forEach(ex=>{
                const id=`${d.date}-${ex.replace(/ /g,"_")}`;
                if(heavyLower.concat(heavyUpper).includes(ex)){
                  total+=5; ['done','weight','rep1','rep2','rep3','rpe'].forEach(f=>prog[id]?.[f] && done++);
                  html+=`<div class="tracking-row">
                    <input type="checkbox" onchange="set('${id}','done',this.checked)" ${prog[id]?.done?'checked':''}/>
                    <label>${ex}</label>
                    Wt:<input type="number" onchange="set('${id}','weight',this.value)" value="${prog[id]?.weight||''}"/>
                    1:<input type="number" onchange="set('${id}','rep1',this.value)" value="${prog[id]?.rep1||''}"/>
                    2:<input type="number" onchange="set('${id}','rep2',this.value)" value="${prog[id]?.rep2||''}"/>
                    3:<input type="number" onchange="set('${id}','rep3',this.value)" value="${prog[id]?.rep3||''}"/>
                    RPE:<input type="number" onchange="set('${id}','rpe',this.value)" value="${prog[id]?.rpe||''}"/>
                  </div>`;
                } else {
                  total+=4; ['done','rep1','rep2','rep3'].forEach(f=>prog[id]?.[f] && done++);
                  html+=`<div class="tracking-row">
                    <input type="checkbox" onchange="set('${id}','done',this.checked)" ${prog[id]?.done?'checked':''}/>
                    <label>${ex}</label>
                    1:<input type="number" onchange="set('${id}','rep1',this.value)" value="${prog[id]?.rep1||''}"/>
                    2:<input type="number" onchange="set('${id}','rep2',this.value)" value="${prog[id]?.rep2||''}"/>
                    3:<input type="number" onchange="set('${id}','rep3',this.value)" value="${prog[id]?.rep3||''}"/>
                  </div>`;
                }
              });
              html+='</div>';
            }
          }
          html+='</div>'; sec.innerHTML+=html;
        });
        c.appendChild(btn); c.appendChild(sec);
      });
      const pct=total?Math.round(done/total*100):0;
      document.getElementById('progress-text').innerText=`${pct}%`;
      document.getElementById('progress-fill').style.width=`${pct}%`;
      document.querySelectorAll('.collapsible').forEach((b,i)=>{ b.addEventListener('click',()=>{ const n=b.nextElementSibling; n.style.display=n.style.display==='block'?'none':'block'; }); if(openSections.includes(i)) b.nextElementSibling.style.display='block'; });
    }

    function set(id, field, val){
      prog[id] = prog[id]||{};
      prog[id][field] = field==='done'? val:true*val;
      render();
      save();
    }

    function exportLog(){
      let t='Training Log\n\n';
      for(const k in prog) t+=`${k}: ${JSON.stringify(prog[k])}\n`;
      const b=new Blob([t],{type:'text/plain'}), u=URL.createObjectURL(b), a=document.createElement('a');
      a.href=u; a.download='training-log.txt'; a.click(); URL.revokeObjectURL(u);
    }

    window.addEventListener('online',()=>{ online=true; save(); });
    window.addEventListener('offline',()=>{ online=false; upd('error'); });
    document.addEventListener('DOMContentLoaded', async ()=>{ await load(); render(); });
  </script>
</body>
</html>
